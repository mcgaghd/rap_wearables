---
title: "ExtractingGPdata"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

---
title: "R Notebook"
output: rmarkdown::github_document
---

# Further data preparation in R 
testing

## Introduction

In this notebook, we will prepare data for analysis.

Extract GP data 


## How to run this notebook

This notebook should be run in a *RStudio* session. It does *not* require a Spark cluster. See how to set it up [here](https://dnanexus.gitbook.io/uk-biobank-rap/working-on-the-research-analysis-platform/using-rstudio-on-the-research-analysis-platform).

## Set up the session

We load packages we'll use:

```{r, include=FALSE}
# First we need to install packages that aren't already present
pkgs <- c("data.table", "plyr", "dplyr","stringr") # packages we need
pkgs_inst <- pkgs[!{pkgs %in% rownames(installed.packages())}] # check which are not present 
install.packages(pkgs_inst, repos = "https://www.stats.bris.ac.uk/R/") # install

# Load packages
lapply(pkgs, library, character.only = TRUE) # using lapply just allows us to load several packages on one line - this could be replaced with several calls to library()
```

dx download - downloads stored permanent storage RAP data into my temporary session
Needs bash to run 
```{bash}
cd ~/rap_wearables

dx download /users/mcgaghd/PrimaryCare -r
```

```{r}
dat_GPevent <- fread("~/rap_wearables/PrimaryCare/gp_event_data.csv", data.table = FALSE)
dat_GPmap <- fread("~/rap_wearables/PrimaryCare/gp_r2_map_r3.csv", data.table = FALSE)

```

```{r}

head(dat_GPevent)

dat_GPlist <- dat_GPevent %>%
  group_by(eid) %>%
  summarise(
    has_GPrecord = TRUE,
    earliest_event_dt = min(event_dt, na.rm = TRUE),
    data_provider = data_provider[which.min(event_dt)]
  ) %>%
  ungroup()
```

Write out csv
```{r}
write.csv(dat_GPlist, "dat_GPlist.csv")
```

##Full list of eid for everyone who has GP record 
```{bash}
dx upload dat_GPlist.csv --dest /users/mcgaghd/PrimaryCare/dat_GPlist.csv
```




```{r}
bursitis_table <- dat_GPmap %>%
  filter(grepl("Achilles bursitis|Bursitis - shoulder|Bursitis of hip|Bursitis of shoulder|Bursitis of the knee NOS|Bursitis of wrist|Housemaids' knee|Infrapatellar bursitis|Ischial bursitis|Popliteal bursitis|Prepatellar bursitis|Subacromial bursitis|Subdeltoid bursitis|Trochanteric bursitis", READV2_DESC, ignore.case = FALSE))


bursitis_table <- bursitis_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)

bursitis_2 <- bursitis_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
bursitis_2

bursitis_3 <- bursitis_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
bursitis_3
```

Bursitis 
```{r}
bursitis_2 <-  "^(N2116|N2117|N2118|N2140|N2151|N2157|N215A|N2160|N2160|N2160|N2165|N2166|N2173|N2173|N2173|N2225|N2225)$"
bursitis_3 <- "^(N2116|N2117|X706I|N2140|N2151|N2157|X706q|XE1FO|X7073|X7075|N2165|N2166|N2173|N2173|N2177|N2165|N2165)$"


Bursitis_Read2 <- dat_GPevent %>%
  filter(grepl(bursitis_2, read_2, ignore.case = FALSE))

Bursitis_Read3 <- dat_GPevent %>%
  filter(grepl(bursitis_3, read_3, ignore.case = FALSE))

Bursitis_Read2$gp_bursitis <- TRUE
Bursitis_Read3$gp_bursitis <- TRUE
```

```{r}
Bursitis_Read2 <- Bursitis_Read2[, c("eid", "data_provider", "event_dt", "gp_bursitis")]

Bursitis_Read3 <- Bursitis_Read3[, c("eid", "data_provider", "event_dt", "gp_bursitis")]


# Append the two dataframes together
datBursitis_gp <- rbind(Bursitis_Read2, Bursitis_Read3)

```

```{r}
write.csv(datBursitis_gp, "datBursitis_gp.csv") 
```

```{bash}
dx upload datBursitis_gp.csv --dest /users/mcgaghd/PrimaryCare/datBursitis_gp.csv
```

Enthesitis 
```{r}
enthesitis_table <- dat_GPmap %>%
  filter(grepl("Acquired trigger thumb|Bicipital tenosynovitis|Enthesopathy of the knee|Enthesopathy of the wrist and carpus|Extensor hallucis longus tenosynovitis|Extensor tenosynovitis of thumb|Extensor tenosynovitis of wrist|Flexor tenosynovitis of finger|Flexor tenosynovitis of thumb|Flexor tenosynovitis of wrist|Impingement syndrome of shoulder|Lateral epicondylitis of the elbow|Medial epicondylitis of the elbow|Other synovitis and tenosynovitis|Other tenosynovitis of hand or wrist|Other tenosynovitis of the hand|Other tenosynovitis of the wrist|Painful arc syndrome|Plantar fasciitis|Policeman's heel|Radial styloid tenosynovitis|Rotator cuff shoulder syndrome and allied disorders|Rotator cuff syndrome, unspecified|Subacromial impingement|Supraspinatus syndrome|Tender heel pad|Tennis elbow|Tenosynovitis of ankle|Tenosynovitis of foot|Thumb trigger|Tibialis anterior tenosynovitis|Trigger thumb - acquired", READV2_DESC, ignore.case = FALSE))

enthesitis_table <- enthesitis_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)

enthesitis_2 <- enthesitis_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
enthesitis_2

enthesitis_3 <- enthesitis_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
enthesitis_3


enthesitis_2 <-  "^(N211.|N2110|N2110|N2110|N2110|N2112|N2122|N2124|N2131|N2131|N2131|N2132|N2132|N2132|N214.|N216.|N2179|N2179|N2204|N2204|N2204|N2204|N2204|N2204|N2205|N2205|N2205|N2205|N2205|N2206|N2207|N220A|N220B|N220C|N220D|N220F|N220G|N220J|N220L|N220z|N220z|N220z|N220z|N2456|Nyu91)$"
enthesitis_3 <- "^(N211.|XE1FM|S5Q2.|S5Q2.|X706F|N2112|N2122|X706H|N2131|N2131|N2131|N2132|N2132|N2132|N214.|N216.|N2179|N2179|XE1FV|X40HS|XE1FV|N220G|N220G|N220G|XE1FW|X706X|X706W|XE1FW|X707t|N2206|N2207|N220A|N220B|N220C|N220D|N220F|N220G|N220J|N220L|XE1FX|X702H|X702F|X702G|N2456|Nyu91)$"


Enthesitis_Read2 <- dat_GPevent %>%
  filter(grepl(enthesitis_2, read_2, ignore.case = FALSE))

Enthesitis_Read3 <- dat_GPevent %>%
  filter(grepl(enthesitis_3, read_3, ignore.case = FALSE))

Enthesitis_Read2$gp_enthesitis <- TRUE
Enthesitis_Read3$gp_enthesitis <- TRUE
```

```{r}
Enthesitis_Read2 <- Enthesitis_Read2[, c("eid", "data_provider", "event_dt", "gp_enthesitis")]

Enthesitis_Read3 <- Enthesitis_Read2[, c("eid", "data_provider", "event_dt", "gp_enthesitis")]


# Append the two dataframes together
datEnthesitis_gp <- rbind(Enthesitis_Read2, Enthesitis_Read3)

```

```{r}
write.csv(Enthesitis_Read3, "Enthesitis_Read3.csv") 
```

```{bash}
dx upload Enthesitis_Read3.csv --dest /users/mcgaghd/PrimaryCare/Enthesitis_Read3.csv
```



Tendonitis 
```{r}

tendonitis_table <- dat_GPmap %>%
  filter(grepl("Achilles tendinitis|Adductor tendinitis|Adductor tendonitis|Bicepital tendonitis|Calcifying tendinitis of the shoulder|De Quervain's disease|Gluteal tendinitis|Patellar tendinitis|Peroneal tendinitis|Psoas tendinitis|Rotator cuff syndrome NOS|Semimembranosus tendinitis|Shoulder tendonitis|Supraspinatus tendinitis|Supraspinatus tendonitis|Tendinitis NOS|Tendonitis adductor|Tendonitis bicepital|Tendonitis NOS|Tendonitis of thumb|Tibialis anterior tendinitis|Tibialis posterior tendinitis|Trochanteric tendinitis", TERMV2_DESC, ignore.case = FALSE))

tendonitis_table <- tendonitis_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)

tendonitis_2 <- tendonitis_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
tendonitis_2

tendonitis_3 <- tendonitis_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
tendonitis_3

tendonitis_2 <-  "^(N2111|N2113|N211z|N2125|N2152|N2154|N2155|N2156|N2164|N2169|N2174|N2175|N2176|N2178|N21z2|N21z2|N21z2|N21z2|N21z2|N21z2|N21z2|N21z2|N21z2|N2204|N2204|N2205)$"
tendonitis_3 <- "^(N2111|N2113|XE1FN|N2125|N2152|N2154|N2155|N2156|N2164|N2169|N2174|N2175|N2176|N2178|XE1FS|N2156|N2134|N2134|N2113|N2156|N2134|N2134|XE1FS|X40HS|XE1FV|XE1FW)$"


tendonitis_Read2 <- dat_GPevent %>%
  filter(grepl(tendonitis_2, read_2, ignore.case = FALSE))

tendonitis_Read3 <- dat_GPevent %>%
  filter(grepl(tendonitis_3, read_3, ignore.case = FALSE))

tendonitis_Read2$gp_tendonitis <- TRUE
tendonitis_Read3$gp_tendonitis <- TRUE
```

```{r}
tendonitis_Read2 <- tendonitis_Read2[, c("eid", "data_provider", "event_dt", "gp_tendonitis")]

tendonitis_Read3 <- tendonitis_Read3[, c("eid", "data_provider", "event_dt", "gp_tendonitis")]


# Append the two dataframes together
datTendonitis_gp <- rbind(tendonitis_Read2, tendonitis_Read3)

```

```{r}
write.csv(datTendonitis_gp, "datTendonitis_gp.csv") 
```

```{bash}
dx upload datTendonitis_gp.csv --dest /users/mcgaghd/PrimaryCare/datTendonitis_gp.csv
```


fatigue
```{r}
fatigue_table <- dat_GPmap %>%
  filter(grepl("Asthenia NOS|Fatigue|General weakness|Lassitude|Lethargy|Malaise|Malaise and fatigue|Malaise and fatigue NOS|Tiredness|Fatigue syndrome|C/O - 'tired all the time'|C/O - debility - malaise|Exhaustion|Fatigue|Fatigue - symptom|Heavy feeling|Lethargy - symptom|Malaise/lethargy|Tired all the time|Tiredness symptom|Tiredness symptom NOS|Malaise - symptom", TERMV2_DESC, ignore.case = FALSE))

fatigue_table <- fatigue_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)

fatigue_table <- fatigue_table[!grepl("pregnancy|vertebra|exposure", fatigue_table$READV2_DESC, ignore.case = TRUE), ]


fatigue_2 <- fatigue_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
fatigue_2

fatigue_3 <- fatigue_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
fatigue_3

fatigue_2 <-  "^(168..|168..|168..|168..|168..|1682.|1683.|1684.|1684.|1687.|1688.|168Z.|E205.|Eu460|Eu460|Eu460|R007.|R0070|R0071|R0072|R0072|R0072|R0073|R0075|R007z|R007z)$"
fatigue_3 <- "^(XE0qj|XM0D3|XM06o|XM06m|XM06m|1682.|XE0qk|XE0ql|XM0Ce|1687.|X76Ae|168Z.|XE0qk|1682.|XE1YD|XE1YD|R007.|R0070|R0071|R0072|R0072|X76Am|R0073|R0075|R007z|R007z)$"


Fatigue_Read2 <- dat_GPevent %>%
  filter(grepl(fatigue_2, read_2, ignore.case = FALSE))

Fatigue_Read3 <- dat_GPevent %>%
  filter(grepl(fatigue_3, read_3, ignore.case = FALSE))

Fatigue_Read2$gp_fatigue <- TRUE
Fatigue_Read3$gp_fatigue <- TRUE
```

```{r}
Fatigue_Read2 <- Fatigue_Read2[, c("eid", "data_provider", "event_dt", "gp_fatigue")]

Fatigue_Read3 <- Fatigue_Read3[, c("eid", "data_provider", "event_dt", "gp_fatigue")]


# Append the two dataframes together
datFatigue_gp <- rbind(Fatigue_Read2, Fatigue_Read3)

```

```{r}
write.csv(datFatigue_gp, "datFatigue_gp.csv") 
```

```{bash}
dx upload datFatigue_gp.csv --dest /users/mcgaghd/PrimaryCare/datFatigue_gp.csv
```


Arthralgia 
```{r}
Arthralgia_table <- dat_GPmap %>%
  filter(grepl("[D]General aches and pains|[D]Musculoskeletal pain|Ache in joint|Arthralgia NOS|Arthralgia of multiple joints|Arthralgia of other specified site|Arthralgia of unspecified site|Musculoskeletal pain - joints|O/E - joint movement painful|Pain in joint - arthralgia|Rheumat.dis.- joints affected|Rheumatism unspecified|Rheumatism, excluding the back|arthralgia", TERMV2_DESC, ignore.case = FALSE))

Arthralgia_table <- Arthralgia_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)


arthralgia_2 <- Arthralgia_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
arthralgia_2

arthralgia_3 <- Arthralgia_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
arthralgia_3

arthralgia_2 <-  "^(2H45.|66H3.|N094.|N094.|N094.|N0940|N0948|N0949|N094z|N096.|N096.|N2...|N2400)$"
arthralgia_3 <- "^(2H45.|66H3.|XE1EY|XE1EY|XE1EY|N0940|N0948|N0949|N094z|XE1EY|XE1EY|N2...|N2400)$"


arthralgia_Read2 <- dat_GPevent %>%
  filter(grepl(arthralgia_2, read_2, ignore.case = FALSE))

arthralgia_Read3 <- dat_GPevent %>%
  filter(grepl(arthralgia_3, read_3, ignore.case = FALSE))

arthralgia_Read2$gp_arthralgia <- TRUE
arthralgia_Read3$gp_arthralgia <- TRUE
```

```{r}
arthralgia_Read2 <- arthralgia_Read2[, c("eid", "data_provider", "event_dt", "gp_arthralgia")]

arthralgia_Read3 <- arthralgia_Read3[, c("eid", "data_provider", "event_dt", "gp_arthralgia")]


# Append the two dataframes together
datArthralgia_gp <- rbind(arthralgia_Read2, arthralgia_Read3)

```

```{r}
write.csv(datArthralgia_gp, "datArthralgia_gp.csv") 
```

```{bash}
dx upload datArthralgia_gp.csv --dest /users/mcgaghd/PrimaryCare/datArthralgia_gp.csv
```

Back pain 
```{r}
BackPain_table <- dat_GPmap %>%
  filter(grepl("Acute back pain - disc|Acute back pain - lumbar|Acute back pain - thoracic|Acute back pain - unspecified|Arthralgia of sacro-iliac joint|Back pain without radiation NOS|Back pain worse on sneezing|Back pain, unspecified|Backache|Backache symptom|Backache symptom NOS|Backache with radiation|Backache, unspecified|C/O - low back pain|C/O - lumbar pain|C/O - upper back ache|Cervical radiculitis|Chronic low back pain|Exacerbation of backache|Facet joint syndrome|Low back pain|Lumbago|Lumbalgia|Pain in buttock|Pain in cervical spine|Pain in coccyx|Pain in lumbar spine|Pain in thoracic spine"
, TERMV2_DESC, ignore.case = FALSE))

BackPain_table <- BackPain_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)


BackPain_2 <- BackPain_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
BackPain_2

BackPain_3 <- BackPain_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
BackPain_3

BackPain_2 <-  "^(6C..|16C2.|16C3.|16C4.|16C5.|16C6.|16C7.|16C8.|16C9.|16CZ.|1A53.|8CMW0|N094L|N094L|N12..|N12..|N12..|N131.|N134.|N141.|N141.|N142.|N1420|N145.|N145.|N1472|N14y.|N245.)$"
BackPain_3 <- "^(16C..|16C2.|16C3.|16C4.|16C5.|16C6.|16C7.|XaINe|Xa0sK|16CZ.|XM0Cq|XaZdZ|N094L|N094L|X70Cg|X70Cg|Xa0sM|Xa0wj|XE1F5|XE1FA|Xa0wp|XE1FB|Xa0sM|Xa0wt|Xa0wt|Xa0wt|Xa0wt|N1420|XE1FE|XE1FE|XE1FE|N1472|X75s4|Xa0wz)$"


BackPain_Read2 <- dat_GPevent %>%
  filter(grepl(BackPain_2, read_2, ignore.case = FALSE))

BackPain_Read3 <- dat_GPevent %>%
  filter(grepl(BackPain_3, read_3, ignore.case = FALSE))

BackPain_Read2$gp_BackPain <- TRUE
BackPain_Read3$gp_BackPain <- TRUE
```

```{r}
BackPain_Read2 <- BackPain_Read2[, c("eid", "data_provider", "event_dt", "gp_BackPain")]

BackPain_Read3 <- BackPain_Read3[, c("eid", "data_provider", "event_dt", "gp_BackPain")]


# Append the two dataframes together
datBackPain_gp <- rbind(BackPain_Read2, BackPain_Read3)

```

```{r}
write.csv(datBackPain_gp, "datBackPain_gp.csv") 
```

```{bash}
dx upload datBackPain_gp.csv --dest /users/mcgaghd/PrimaryCare/datBackPain_gp.csv
```

"Arthralgia of 1st MTP joint|Arthralgia of DIP joint of finger|Arthralgia of MCP joint|Arthralgia of PIP joint of finger|Finger pain"


Finger pain pain 
```{r}
FingerPain_table <- dat_GPmap %>%
  filter(grepl("Arthralgia", READV2_DESC, ignore.case = FALSE))

FingerPain_table <- dat_GPmap %>%
  filter(grepl("Arthralgia of metacarpophalangeal joint|Arthralgia of proximal interphalangeal joint of finger|Effusion of metacarpophalangeal joint|Stiff metacarpophalangeal joint NEC|Synovial osteochondromatosis of metacarpophalangeal joint|Transient arthropathy of metacarpophalangeal joint|Arthralgia of metacarpophalangeal joint", READV2_DESC, ignore.case = FALSE))

FingerPain_table <- FingerPain_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)


FingerPain_2 <- FingerPain_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
FingerPain_2

FingerPain_3 <- FingerPain_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
FingerPain_3

FingerPain_2 <-  "^(N064G|N090G|N094G|N094H|N095G|N0986)$"
FingerPain_3 <- "^(N064G|N090G|N094G|N094H|N095G|N0986)$"


FingerPain_Read2 <- dat_GPevent %>%
  filter(grepl(FingerPain_2, read_2, ignore.case = FALSE))

FingerPain_Read3 <- dat_GPevent %>%
  filter(grepl(FingerPain_3, read_3, ignore.case = FALSE))

FingerPain_Read2$gp_FingerPain <- TRUE
FingerPain_Read3$gp_FingerPain <- TRUE
```

```{r}
FingerPain_Read2 <- FingerPain_Read2[, c("eid", "data_provider", "event_dt", "gp_FingerPain")]

FingerPain_Read3 <- FingerPain_Read3[, c("eid", "data_provider", "event_dt", "gp_FingerPain")]


# Append the two dataframes together
datFingerPain_gp <- rbind(FingerPain_Read2, FingerPain_Read3)

```

```{r}
write.csv(datFingerPain_gp, "datFingerPain_gp.csv") 
```

```{bash}
dx upload datFingerPain_gp.csv --dest /users/mcgaghd/PrimaryCare/datFingerPain_gp.csv
```

Hand pain pain 
```{r}
WristHandPain_table <- dat_GPmap %>%
  filter(grepl("Arthralgia of the hand|Carpal tunnel|Hand joint pain|Hand pain|Hand pain|Thumb pain|Arthralgia of wrist|Pain in wrist|Wrist joint pain|Wrist pain|Effusion of distal radio-ulnar joint|Arthralgia of distal radio-ulnar joint|Stiff distal radio-ulnar joint NEC", READV2_DESC, ignore.case = FALSE))


WristHandPain_table <- WristHandPain_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)


WristHandPain_2 <- WristHandPain_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
WristHandPain_2

WristHandPain_3 <- WristHandPain_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
WristHandPain_3

WristHandPain_2 <-  "^(1M01.|70560|70560|F340.|F340.|F340.|N090E|N0944|N0944|N094E|N094E|N094F|N094F|N095E|N2450|N2450|N2450)$"
WristHandPain_3 <- "^(SJyV|70560|70560|XE15g|XE15g|XM1Pq|N090E|N0944|N0944|N094E|N094E|N094F|N094F|N095E|X75sC|XM1NJ|Xa7m9)$"


WristHandPain_Read2 <- dat_GPevent %>%
  filter(grepl(WristHandPain_2, read_2, ignore.case = FALSE))

WristHandPain_Read3 <- dat_GPevent %>%
  filter(grepl(WristHandPain_3, read_3, ignore.case = FALSE))

WristHandPain_Read2$gp_WristHandPain <- TRUE
WristHandPain_Read3$gp_WristHandPain <- TRUE
```

```{r}
WristHandPain_Read2 <- WristHandPain_Read2[, c("eid", "data_provider", "event_dt", "gp_WristHandPain")]

WristHandPain_Read3 <- WristHandPain_Read3[, c("eid", "data_provider", "event_dt", "gp_WristHandPain")]


# Append the two dataframes together
datWristHandPain_gp <- rbind(WristHandPain_Read2, WristHandPain_Read3)

```

```{r}
write.csv(datWristHandPain_gp, "datWristHandPain_gp.csv") 
```

```{bash}
dx upload datWristHandPain_gp.csv --dest /users/mcgaghd/PrimaryCare/datWristHandPain_gp.csv
```

Swelling 

```{r}
swelling_table <- dat_GPmap %>%
  filter(grepl("Ankle joint effusion|Ankle swelling|Ankle swelling symptom|Joint effusion of the lower leg|Effusion of 1st MTP joint|Swollen toe|Finger swelling|Joint effusion of the hand|Swollen finger|Swollen hand|Swollen thumb|Effusion of elbow|Synovitis of elbow|Effusion of knee|Knee joint effusion|Baker's cyst|Swollen knee|Synovitis of knee|Shoulder synovitis|Synovitis of elbow|Synovitis of shoulder|C/O: a swelling|Effusion of joint|Effusion of joint NOS|Intermittent joint effusion|Joint effusion of unspecified site|O/E - a swelling|O/E - joint effusion present|O/E - joint swelling|O/E - joint swelling NOS|O/E - swelling - joint|Swelling|Swelling of joint - effusion|Swollen joint|Swollen joint count|Synovitis and tenosynovitis|Synovitis NOS|Synovitis or tenosynovitis NOS", TERMV3_DESC, ignore.case = FALSE))


swelling_table <- swelling_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)

swelling_table <- swelling_table[!grepl("eye|bacterial|head or neck|ear|mandibular|chest|scrotum|abdomen|injection|implantable|Ankle swelling|Oedema|mass or lump", swelling_table$READV2_DESC, ignore.case = TRUE), ]


swelling_2 <- swelling_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
swelling_2

swelling_3 <- swelling_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
swelling_3

swelling_2 <-  "^(16J..|16J1.|16J2.|16J3.|16J4.|16J6.|1834.|1834.|1D11.|2H3..|2H3..|2H32.|2H3Z.|2I12.|N0900|N0904|N0906|N0906|N0907|N090D|N090M|N090W|N090z|N093.|N220.|N2200|N2201|N220T|N220V|N220W|N220X|N220z|N220z|N220z|N2251|N2470|N2470|R0220)$"
swelling_3 <- "^(X76Eu|Xa0YT|XaFo3|XM062|X76FE|Xa76B|1834.|1834.|1D11.|2H3..|2H3..|2H32.|2H3Z.|2I12.|N0900|N0904|XE1EQ|N090M|N090P|N090D|N090M|X701A|N090z|X701A|N220.|N2200|N2201|XaLSe|X702G|X702F|X702H|X702H|X702F|X702G|X70CQ|XE1Fq|Xa1sY|R0220)$"


Swelling_Read2 <- dat_GPevent %>%
  filter(grepl(swelling_2, read_2, ignore.case = FALSE))

Swelling_Read3 <- dat_GPevent %>%
  filter(grepl(swelling_3, read_3, ignore.case = FALSE))

Swelling_Read2$gp_swelling <- TRUE
Swelling_Read3$gp_swelling <- TRUE
```

```{r}
Swelling_Read2 <- Swelling_Read2[, c("eid", "data_provider", "event_dt", "gp_swelling")]

Swelling_Read3 <- Swelling_Read3[, c("eid", "data_provider", "event_dt", "gp_swelling")]


# Append the two dataframes together
datSwelling_gp <- rbind(Swelling_Read2, Swelling_Read3)

```

```{r}
write.csv(datSwelling_gp, "datSwelling_gp.csv") 
```

```{bash}
dx upload datSwelling_gp.csv --dest /users/mcgaghd/PrimaryCare/datSwelling_gp.csv

```
Stiffness 

```{r}
stiffness_table <- dat_GPmap %>%
  filter(grepl("Ankle stiff|Back stiffness|Hip stiff|Knee stiff|Stiff joint NEC, of the ankle and foot|Stiff joint NEC, of the upper arm|Stiff knee NEC|C/O: stiffness|Joint stiffness NEC|Joint stiffness NEC, NOS|Morning stiffness - joint|Multiple stiff joints|O/E - joint stiff|O/E - joint stiffness|O/E - joint stiffness NOS|Hand joint stiff|Shoulder stiff|Stiff finger|Stiff joint NEC, of the hand|Stiff joint NEC, of the shoulder region|Stiff neck NOS|Wrist stiff", TERMV3_DESC, ignore.case = FALSE))


stiffness_table <- stiffness_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)



stiffness_2 <- stiffness_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
stiffness_2

stiffness_3 <- stiffness_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
stiffness_3

stiffness_2 <-  "^(1D12.|1D17.|2H6..|2H62.|2H6Z.|N095.|N0951|N0951|N0952|N0953|N0954|N0954|N0955|N0956|N0957|N0957|N0959|N095M|N095z|N135z|N149.)$"
stiffness_3 <- "^(1D12.|Xa0YV|2H6..|2H62.|2H6Z.|N095.|XE1Ef|X76mj|XE1Eg|X76mh|XE1Ei|X76mg|X76mf|X76me|XE1El|X76md|N0959|N095M|N095z|X76ml|X76mm)$"


Stiffness_Read2 <- dat_GPevent %>%
  filter(grepl(stiffness_2, read_2, ignore.case = FALSE))

Stiffness_Read3 <- dat_GPevent %>%
  filter(grepl(stiffness_3, read_3, ignore.case = FALSE))

Stiffness_Read2$gp_stiffness <- TRUE
Stiffness_Read3$gp_stiffness <- TRUE
```

```{r}
Stiffness_Read2 <- Stiffness_Read2[, c("eid", "data_provider", "event_dt", "gp_stiffness")]

Stiffness_Read3 <- Stiffness_Read3[, c("eid", "data_provider", "event_dt", "gp_stiffness")]


# Append the two dataframes together
datStiffness_gp <- rbind(Stiffness_Read2, Stiffness_Read3)

```

```{r}
write.csv(datStiffness_gp, "datStiffness_gp.csv") 
```

```{bash}
dx upload datStiffness_gp.csv --dest /users/mcgaghd/PrimaryCare/datStiffness_gp.csv
```

Myalgia
```{r}


myalgia_table <- dat_GPmap %>%
  filter(grepl("Aching muscles|Muscle pain|Muscular rheumatism|Myalgia and myositis unspecified|Myalgia unspecified|Myositis unspecified|Nonarticular rheumatism NOS|Polymyalgia", TERMV3_DESC, ignore.case = FALSE))


myalgia_table <- myalgia_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)


myalgia_2 <- myalgia_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
myalgia_2

myalgia_3 <- myalgia_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
myalgia_3

myalgia_2 <-  "^(1DCC.|N20..|N20..|N20..|N2402|N241.|N2410|N2410|N2411|N2z..)$"
myalgia_3 <- "^(X75rs|XE1FJ|XE1FJ|XE1FJ|N2402|N241.|XE1Fm|X75rs|N2411|N2z..)$"


Myalgia_Read2 <- dat_GPevent %>%
  filter(grepl(myalgia_2, read_2, ignore.case = FALSE))

Myalgia_Read3 <- dat_GPevent %>%
  filter(grepl(myalgia_3, read_3, ignore.case = FALSE))

Myalgia_Read2$gp_myalgia <- TRUE
Myalgia_Read3$gp_myalgia <- TRUE
```

```{r}
Myalgia_Read2 <- Myalgia_Read2[, c("eid", "data_provider", "event_dt", "gp_myalgia")]

Myalgia_Read3 <- Myalgia_Read3[, c("eid", "data_provider", "event_dt", "gp_myalgia")]


# Append the two dataframes together
datMyalgia_gp <- rbind(Myalgia_Read2, Myalgia_Read3)

```

```{r}
write.csv(datMyalgia_gp, "datMyalgia_gp.csv") 
```

```{bash}
dx upload datMyalgia_gp.csv --dest /users/mcgaghd/PrimaryCare/datMyalgia_gp.csv

```
Knee pain 

```{r}

KneePain_table <- dat_GPmap %>%
  filter(grepl("knee pain|Arthralgia of knee|Knee joint pain", TERMV3_DESC, ignore.case = FALSE))


KneePain_table <- KneePain_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)


KneePain_2 <- KneePain_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
KneePain_2

KneePain_3 <- KneePain_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
KneePain_3

KneePain_2 <-  "^(1M12.|N0946|N094M|N094W)$"
KneePain_3 <- "^(X700S|N094M|N094M|X700S)$"


KneePain_Read2 <- dat_GPevent %>%
  filter(grepl(KneePain_2, read_2, ignore.case = FALSE))

KneePain_Read3 <- dat_GPevent %>%
  filter(grepl(KneePain_3, read_3, ignore.case = FALSE))

KneePain_Read2$gp_KneePain <- TRUE
KneePain_Read3$gp_KneePain <- TRUE
```

```{r}
KneePain_Read2 <- KneePain_Read2[, c("eid", "data_provider", "event_dt", "gp_KneePain")]

KneePain_Read3 <- KneePain_Read3[, c("eid", "data_provider", "event_dt", "gp_KneePain")]


# Append the two dataframes together
datKneePain_gp <- rbind(KneePain_Read2, KneePain_Read3)

```

```{r}
write.csv(datKneePain_gp, "datKneePain_gp.csv") 
```

```{bash}
dx upload datKneePain_gp.csv --dest /users/mcgaghd/PrimaryCare/datKneePain_gp.csv

```


Hip pain 

```{r}

HipPain_table <- dat_GPmap %>%
  filter(grepl("irritable hip|hip pain|Arthralgia of the pelvic region and thigh|Arthralgia of hip|hip joint pain|painful hip|sore hip|hip ache|hip joint pain", TERMV3_DESC, ignore.case = FALSE))


HipPain_table <- HipPain_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)


HipPain_2 <- HipPain_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
HipPain_2

HipPain_3 <- HipPain_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
HipPain_3

HipPain_2 <-  "^(N0945|N094K)$"
HipPain_3 <- "^(XE1Ec|X75rv)$"


HipPain_Read2 <- dat_GPevent %>%
  filter(grepl(HipPain_2, read_2, ignore.case = FALSE))

HipPain_Read3 <- dat_GPevent %>%
  filter(grepl(HipPain_3, read_3, ignore.case = FALSE))

HipPain_Read2$gp_HipPain <- TRUE
HipPain_Read3$gp_HipPain <- TRUE
```

```{r}
HipPain_Read2 <- HipPain_Read2[, c("eid", "data_provider", "event_dt", "gp_HipPain")]

HipPain_Read3 <- HipPain_Read3[, c("eid", "data_provider", "event_dt", "gp_HipPain")]


# Append the two dataframes together
datHipPain_gp <- rbind(HipPain_Read2, HipPain_Read3)

```

```{r}
write.csv(datHipPain_gp, "datHipPain_gp.csv") 
```

```{bash}
dx upload datHipPain_gp.csv --dest /users/mcgaghd/PrimaryCare/datHipPain_gp.csv

```

```{r}
psori_table <- dat_GPmap %>%
  filter(grepl("(^M16[^0|^2|^3|^4|^5].*$|Myu30|X506Y|X506Z|X506a|X506b|X506c|X506d|X506e|X506f|X506g|X506h|X506i|X506j|X506k|X506l|X506m|X506n|X506o|X506p|X506q|X506r|X506s|X506t|X506u|X506v|XE1CQ|XaNXa|XaNXt|XaYOx)$", READV3_CODE, ignore.case = TRUE))

```

```{r}
psori_table <- dat_GPmap %>%
  filter(grepl("14F2.|Xaa5w|M16..|M161.|M1610|M1611|M1612|M1613|M1614|M1614|M1615|M1616|M1617|M1618|M1619|M1619|M161A|M161B|M161C|M161D|XaYOx|M161E|XaNXt|M161F|XaNXa|X506b|X506Z|M161z|X506m|M16y.|X506i|M16z.|Myu30", READV2_CODE, ignore.case = TRUE))
```

```{r}
psoriasis_table <- dat_GPmap %>%
  filter(grepl("psoriasis", 
               READV2_DESC, ignore.case = TRUE) |
         grepl("psoriasis", 
               TERMV3_DESC, ignore.case = TRUE))

psoriasis_table <- psoriasis_table[!grepl("FH:|family|parapso|spondylitica|arthritis", psoriasis_table$READV2_DESC, ignore.case = TRUE), ]


psoriasis_table <- psoriasis_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)


Psoriasis_2 <- psoriasis_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
Psoriasis_2

Psoriasis_3 <- psoriasis_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
Psoriasis_3

Psoriasis_2 <-  "^(14F2.|38Gg.|M16..|M161.|M1610|M1611|M1612|M1613|M1614|M1614|M1615|M1616|M1617|M1618|M1619|M1619|M161A|M161B|M161C|M161D|M161D|M161E|M161F|M161F|M161F|M161H|M161J|M161z|M166.|M16y.|M16y0|M16z.|Myu30)$"
Psoriasis_3 <- "^(Xaa5w|M16..|M161.|M1610|M1611|M1612|M1613|M1614|M1614|M1615|M1616|M1617|M1618|M1619|M1619|M161A|M161B|M161C|M161D|M161E|XaNXt|M161F|XaNXa|X506b|X506Z|M161z|X506m|M16y.|X506i|M16z.|Myu30)$"


Psoriasis_Read2 <- dat_GPevent %>%
  filter(grepl(Psoriasis_2, read_2, ignore.case = FALSE))

Psoriasis_Read3 <- dat_GPevent %>%
  filter(grepl(Psoriasis_3, read_3, ignore.case = FALSE))

ProbPsA_Read2$gp_ProbPsA <- TRUE
ProbPsA_Read3$gp_ProbPsA <- TRUE
```

```{r}
ProbPsA_Read2 <- ProbPsA_Read2[, c("eid", "data_provider", "event_dt", "gp_ProbPsA")]

ProbPsA_Read3 <- ProbPsA_Read3[, c("eid", "data_provider", "event_dt", "gp_ProbPsA")]


# Append the two dataframes together
datProbPsA_gp <- rbind(ProbPsA_Read2, ProbPsA_Read3)

```

```{r}
write.csv(datProbPsA_gp, "datProbPsA_gp.csv") 
```

```{bash}
dx upload datProbPsA_gp.csv --dest /users/mcgaghd/PrimaryCare/datProbPsA_gp.csv

```

```{r}

ProbPsA_table <- dat_GPmap %>%
  filter(grepl("inflammatory arthritis|spondyl|Seronegative|Marie-Strumpell|Spinal enthesopathy|Sacroiliitis|Spondylitis NOS|polyarthritis|sero ne", 
               READV2_DESC, ignore.case = TRUE) |
         grepl("inflammatory arthritis|spondyl|Seronegative|Marie-Strumpell|Spinal enthesopathy|Sacroiliitis|Spondylitis NOS|polyarthritis|sero ne", 
               TERMV3_DESC, ignore.case = TRUE))


ProbPsA_table <- ProbPsA_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)

ProbPsA_table <- ProbPsA_table[!grepl("FH:|hyperuric|spondylolisthesis|gonoc|Myelopathy|Myelopathy|nerve root|Cervical spondylosis|thoracic spondylosis|Traumatic|brucella|Lumbosacral spondylosis|Other infective|fracture|Other spondylosis|Psoriasis spondylitica|Primary posterior fusion|Other spondyloses and allied disorders|neuropathic|enterobac|Other specified spond|Platyspondylia|Congenital lumbosacral spondylol|Juvenile|parasitic|Spondyloptosis|dysplasia|diseases classified elsewhere|bacterial agents|coccal|Spondylosis|BASDAI|Spondylolysis|Spondylopathy, unspecified|pondylopathie", ProbPsA_table$READV2_DESC, ignore.case = TRUE), ]


ProbPsA_2 <- ProbPsA_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
ProbPsA_2

ProbPsA_3 <- ProbPsA_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
ProbPsA_3

ProbPsA_2 <-  "^(1JG..|2377.|388p0|38QL.|N040P|N04y1|N04y1|N04y1|N04y3|N065.|N065.|N065z|N065z|N100.|N100.|N100.|N101.|N102.|N10z.|N11F.)$"
ProbPsA_3 <- "^(XaNdh|2377.|Xab3F|Xab3Q|X701i|N04y1|N04y1|N04y1|XaX5I|XE2Qc|XE2Qc|XE1Di|X702I|N100.|N100.|N100.|N101.|N102.|N10z.|XabRZ)$"


ProbPsA_Read2 <- dat_GPevent %>%
  filter(grepl(ProbPsA_2, read_2, ignore.case = FALSE))

ProbPsA_Read3 <- dat_GPevent %>%
  filter(grepl(ProbPsA_3, read_3, ignore.case = FALSE))

ProbPsA_Read2$gp_ProbPsA <- TRUE
ProbPsA_Read3$gp_ProbPsA <- TRUE
```

```{r}
ProbPsA_Read2 <- ProbPsA_Read2[, c("eid", "data_provider", "event_dt", "gp_ProbPsA")]

ProbPsA_Read3 <- ProbPsA_Read3[, c("eid", "data_provider", "event_dt", "gp_ProbPsA")]


# Append the two dataframes together
datProbPsA_gp <- rbind(ProbPsA_Read2, ProbPsA_Read3)

```

```{r}
write.csv(datProbPsA_gp, "datProbPsA_gp.csv") 
```

```{bash}
dx upload datProbPsA_gp.csv --dest /users/mcgaghd/PrimaryCare/datProbPsA_gp.csv

```


```{r}
psori_table <- dat_GPmap %>%
  filter(grepl("N04y1|N040P|N11F.|N10..|N100.|N101.|N102.|N10y.|N10y0|N10yz|N10z.|Y70EZ|Y70Df|YaxFh|Y70Ef|Y70nw|Y70nz", READV2_CODE, ignore.case = TRUE))
```

```{r}

ProbPsA_table <- dat_GPmap %>%
  filter(grepl("inflammatory arthritis|spondyl|Seronegative|Marie-Strumpell|Spinal enthesopathy|Sacroiliitis|Spondylitis NOS|polyarthritis|sero ne", 
               READV2_DESC, ignore.case = TRUE) |
         grepl("inflammatory arthritis|spondyl|Seronegative|Marie-Strumpell|Spinal enthesopathy|Sacroiliitis|Spondylitis NOS|polyarthritis|sero ne", 
               TERMV3_DESC, ignore.case = TRUE))


ProbPsA_table <- ProbPsA_table %>% 
  select(READV2_DESC, READV2_CODE, READV3_CODE)

ProbPsA_table <- ProbPsA_table[!grepl("FH:|hyperuric|spondylolisthesis|gonoc|Myelopathy|Myelopathy|nerve root|Cervical spondylosis|thoracic spondylosis|Traumatic|brucella|Lumbosacral spondylosis|Other infective|fracture|Other spondylosis|Psoriasis spondylitica|Primary posterior fusion|Other spondyloses and allied disorders|neuropathic|enterobac|Other specified spond|Platyspondylia|Congenital lumbosacral spondylol|Juvenile|parasitic|Spondyloptosis|dysplasia|diseases classified elsewhere|bacterial agents|coccal|Spondylosis|BASDAI|Spondylolysis|Spondylopathy, unspecified|pondylopathie", ProbPsA_table$READV2_DESC, ignore.case = TRUE), ]


ProbPsA_2 <- ProbPsA_table %>% 
  pull(READV2_CODE) %>% 
  paste(collapse = "|")
ProbPsA_2

ProbPsA_3 <- ProbPsA_table %>% 
  pull(READV3_CODE) %>% 
  paste(collapse = "|")
ProbPsA_3

ProbPsA_2 <-  "^(1JG..|2377.|388p0|38QL.|N040P|N04y1|N04y1|N04y1|N04y3|N065.|N065.|N065z|N065z|N100.|N100.|N100.|N101.|N102.|N10z.|N11F.)$"
ProbPsA_3 <- "^(XaNdh|2377.|Xab3F|Xab3Q|X701i|N04y1|N04y1|N04y1|XaX5I|XE2Qc|XE2Qc|XE1Di|X702I|N100.|N100.|N100.|N101.|N102.|N10z.|XabRZ)$"


ProbPsA_Read2 <- dat_GPevent %>%
  filter(grepl(ProbPsA_2, read_2, ignore.case = FALSE))

ProbPsA_Read3 <- dat_GPevent %>%
  filter(grepl(ProbPsA_3, read_3, ignore.case = FALSE))

ProbPsA_Read2$gp_ProbPsA <- TRUE
ProbPsA_Read3$gp_ProbPsA <- TRUE
```

```{r}
ProbPsA_Read2 <- ProbPsA_Read2[, c("eid", "data_provider", "event_dt", "gp_ProbPsA")]

ProbPsA_Read3 <- ProbPsA_Read3[, c("eid", "data_provider", "event_dt", "gp_ProbPsA")]


# Append the two dataframes together
datProbPsA_gp <- rbind(ProbPsA_Read2, ProbPsA_Read3)

```

```{r}
write.csv(datProbPsA_gp, "datProbPsA_gp.csv") 
```

```{bash}
dx upload datProbPsA_gp.csv --dest /users/mcgaghd/PrimaryCare/datProbPsA_gp.csv

```

Probable Arthritis
```{r}
Prob_2 <-  "^(N04y1|N040P|N11F.|N10..|N100.|N101.|N102.|N10y.|N10y0|N10yz|N10z.|Y70EZ|Y70Df|YaxFh|Y70Ef|Y70nw|Y70nz)$"
Prob_3 <- "^(N04y1|N040P|N11F.|N10..|N100.|N101.|N102.|N10y.|N10y0|N10yz|N10z.|Y70EZ|Y70Df|YaxFh|Y70Ef|Y70nw|Y70nz)$"

ProbablePsA_Read2 <- dat_GPevent %>%
  filter(grepl(Prob_2, read_2, ignore.case = FALSE))

ProbablePsA_Read3 <- dat_GPevent %>%
  filter(grepl(Prob_3, read_3, ignore.case = FALSE))

```

```{r}
ProbablePsA_Read2$gp_ProbablePsA <- TRUE
ProbablePsA_Read3$gp_ProbablePsA <- TRUE
```

```{r}
ProbablePsA_Read2subset <- ProbablePsA_Read2[, c("eid", "data_provider", "event_dt", "gp_ProbablePsA")]

ProbablePsA_Read3subset <- ProbablePsA_Read3[, c("eid", "data_provider", "event_dt", "gp_ProbablePsA")]


# Append the two dataframes together
datProbPsA_gp <- rbind(ProbablePsA_Read2subset, ProbablePsA_Read3subset)
```

```{r}
write.csv(datProbPsA_gp, "datProbPsA_gp.csv") 
```

```{bash}
dx upload datProbPsA_gp.csv --dest /users/mcgaghd/PrimaryCare/datProbPsA_gp.csv
```

Rheumatoid Factor
```{r}
RF_2 <- "^(43F..)$"
RF_3 <- "^(X80QJ|XE255|X80QJ|X80QJ)$"

RF_Read2 <- dat_GPevent %>%
  filter(grepl(RF_2, read_2, ignore.case = FALSE))

RF_Read3 <- dat_GPevent %>%
  filter(grepl(RF_3, read_3, ignore.case = FALSE))
```

Rheumatoid Arthritis 
```{r}
RA_codes <- "^(N040.|Y70D.|F3712|F3964|14G1.|Nyu11|Nyu12|Nyu1G|XaBMO|X701t|N043.|N042.|X701i|F3964|F3712|2G27.00|2G27.|7P203|XaLsj)$"

RA_Read2 <- dat_GPevent %>%
  filter(grepl(RA_codes, read_2, ignore.case = FALSE))

RA_Read3 <- dat_GPevent %>%
  filter(grepl(RA_codes, read_3, ignore.case = FALSE))
```

```{r}
RA_Read2$gp_RA <- TRUE
RA_Read3$gp_RA <- TRUE
```

```{r}
RA_Read3subset <- RA_Read3[, c("eid", "data_provider", "event_dt", "gp_RA")]

RA_Read2subset <- RA_Read2[, c("eid", "data_provider", "event_dt", "gp_RA")]


# Append the two dataframes together
datRA_gp <- rbind(RA_Read2subset, RA_Read3subset)
```

```{r}
write.csv(datRA_gp, "datRA_gp.csv")
```

```{bash}
dx upload datRA_gp.csv --dest /users/mcgaghd/PrimaryCare/datRA_gp.csv
```

Ank Spond  
```{r}
AS_codes <- "^(N100.|N11F.|Nyu61|388p.00|XaN24|N0450|X701x|N10..00|388p.)$"

AS_Read2 <- dat_GPevent %>%
  filter(grepl(AS_codes, read_2, ignore.case = FALSE))

AS_Read3 <- dat_GPevent %>%
  filter(grepl(AS_codes, read_3, ignore.case = FALSE))
```

```{r}
AS_Read2$gp_AS <- TRUE
AS_Read3$gp_AS <- TRUE
```

```{r}
AS_Read3subset <- AS_Read3[, c("eid", "data_provider", "event_dt", "gp_AS")]

AS_Read2subset <- AS_Read2[, c("eid", "data_provider", "event_dt", "gp_AS")]


# Append the two dataframes together
datAS_gp <- rbind(AS_Read2subset, AS_Read3subset)
```

```{r}
write.csv(datAS_gp, "datAS_gp.csv")
```

```{bash}
dx upload datAS_gp.csv --dest /users/mcgaghd/PrimaryCare/datAS_gp.csv
```

Probable composite 
```{r}


```


DMARD 
```{r}
dmard_2 <- "^(9Oe..|9kN..|66c0.|9Oe0.|9Oe1.)$"
dmard_3 <- "^(XaIuF|XaPKE|XaPKD|XaPEv|XaPKI|XaPDZ|XaPeT|XaPeU|XaQEg|XaQEh|XaPNd|XaPNeV|XaPNf|XaYOh|XaYOk|XaYOl|XaYOm|XaYPB|XaIrA|XaR4Q|XaIr9)$"

dmard_Read2 <- dat_GPevent %>%
  filter(grepl(dmard_2, read_2, ignore.case = FALSE))

dmard_Read3 <- dat_GPevent %>%
  filter(grepl(dmard_3, read_3, ignore.case = FALSE))
```

```{r}
dmard_summary <- dmard_Read3 %>%
  group_by(eid) %>%
   summarise(count = n())
```

```{r}
dmard_Read2$gp_DMARDmonitor <- TRUE
dmard_Read3$gp_DMARDmonitor <- TRUE
```

```{r}
dmard_Read3subset <- dmard_Read3[, c("eid", "data_provider", "event_dt", "gp_DMARDmonitor")]

dmard_Read2subset <- dmard_Read2[, c("eid", "data_provider", "event_dt", "gp_DMARDmonitor")]


# Append the two dataframes together
datDMARDmonitor_gp <- rbind(dmard_Read2subset, dmard_Read3subset)
```

```{r}
write.csv(datDMARDmonitor_gp, "datDMARDmonitor_gp.csv")
```

```{bash}
dx upload datDMARDmonitor_gp.csv --dest /users/mcgaghd/PrimaryCare/datDMARDmonitor_gp.csv
```


Methotrexate 
```{r}
methotrexate_2 <- "^(44Wa.|44WQ.|7L168|7L186|7L19H)$"
methotrexate_3 <- "^(XaERh|XaERd|XaC0H|XaC0G|XaNfV|Y28f4)$"

methotrexate_Read2 <- dat_GPevent %>%
  filter(grepl(methotrexate_2, read_2, ignore.case = FALSE))

methotrexate_Read3 <- dat_GPevent %>%
  filter(grepl(methotrexate_3, read_3, ignore.case = FALSE))
```


```{r}
methotrexate_Read2$gp_methotrexate <- TRUE
methotrexate_Read3$gp_methotrexate <- TRUE
```

```{r}
methotrexate_Read3subset <- methotrexate_Read3[, c("eid", "data_provider", "event_dt", "gp_methotrexate")]

methotrexate_Read2subset <- methotrexate_Read2[, c("eid", "data_provider", "event_dt", "gp_methotrexate")]


# Append the two dataframes together
datMethotrexate_gp <- rbind(methotrexate_Read2subset, methotrexate_Read3subset)
```

```{r}
write.csv(datMethotrexate_gp, "datMethotrexate_gp.csv")
```

```{bash}
dx upload datMethotrexate_gp.csv --dest /users/mcgaghd/PrimaryCare/datMethotrexate_gp.csv
```

```{r}
InsomniaParasomniaSomnolenceStrings <-
  "^(1B1B.|1B1B0|1B1B1|1B1B2|E2742|XE1Yg|XM0CT|XE2Pv|XE2Pv|1B6C.|Fy01.|XaZKa|Fy01.|YMAyr|YavSB|X008H|Y7DN7|Y00RD|YM1id|YM1ie|YaYSN|YaYSO|YaYSP|YavSB|Y00RF|YMAyr)$"

InsomniaParasomniaSomnolence_Read2 <- dat_GPevent %>%
  filter(grepl(InsomniaParasomniaSomnolenceStrings, read_2, ignore.case = TRUE))

InsomniaParasomniaSomnolence_Read3 <- dat_GPevent %>%
  filter(grepl(InsomniaParasomniaSomnolenceStrings, read_3, ignore.case = TRUE))
```

```{r}
InsomniaParasomniaSomnolence_Read2$gp_Insomnia <- TRUE
InsomniaParasomniaSomnolence_Read3$gp_Insomnia <- TRUE
```

```{r}
InsomnniaParaSomnolence_Read3subset <- InsomniaParasomniaSomnolence_Read3[, c("eid", "data_provider", "event_dt", "gp_Insomnia")]
InsomnniaParaSomnolence_Read2subset <- InsomniaParasomniaSomnolence_Read2[, c("eid", "data_provider", "event_dt", "gp_Insomnia")]

# Append the two dataframes together
datInsomParaSomn_gp <- rbind(InsomnniaParaSomnolence_Read2subset, InsomnniaParaSomnolence_Read3subset)
```

```{r}
write.csv(datInsomParaSomn_gp, "datInsomParaSomn_gp.csv")
```

```{bash}
dx upload datInsomParaSomn_gp.csv --dest /users/mcgaghd/PrimaryCare/datInsomParaSomn_gp.csv
```

Loss of smell, taste 
```{r}
tasteStrings <- "^(1B45.|ZV415|Ya0j1|YMAXU|Ryu52|XM070|Y7CiV|ZV415|Ya0j0|XM0CX|YM1ih|XM0CW|YM1ig|XE0rs|Y7Cip|Y00SS|XE0rs|1924.|R011.)$"
                 
SmellTaste_Read2 <- dat_GPevent %>%
  filter(grepl(tasteStrings, read_2, ignore.case = TRUE))

SmellTaste_Read3 <- dat_GPevent %>%
  filter(grepl(tasteStrings, read_3, ignore.case = TRUE))

```

```{r}
SmellTaste_Read2$gp_SmellTaste <- TRUE
SmellTaste_Read3$gp_SmellTaste <- TRUE
```

```{r}
SmellTaste_Read3subset <- SmellTaste_Read3[, c("eid", "data_provider", "event_dt", "gp_SmellTaste")]

SmellTaste_Read2subset <- SmellTaste_Read2[, c("eid", "data_provider", "event_dt", "gp_SmellTaste")]


# Append the two dataframes together
datSmellTaste_gp <- rbind(SmellTaste_Read2subset, SmellTaste_Read3subset)
```

```{r}
write.csv(datSmellTaste_gp, "datSmellTaste_gp.csv")
```

```{bash}
dx upload datSmellTaste_gp.csv --dest /users/mcgaghd/PrimaryCare/datSmellTaste_gp.csv
```

Tremor
```{r}
tremor_Strings<- "^(1B22.*|2975.*|2976.*|297A.*|F1311|Fyu25|R0103|XE0rn|R0103|YM0we|Y00KK|XaKV6|Yann8|YM0Hn|YM0Hj|YM0Hg|Y7F0N|Y7F0R|Y7937|Y7937)$"

# Create the new column "PsO_v2" based on the matching condition
tremor_Read2 <- dat_GPevent %>%
  filter(grepl(tremor_Strings, read_2, ignore.case = TRUE))

tremor_Read3 <- dat_GPevent %>%
  filter(grepl(tremor_Strings, read_3, ignore.case = TRUE))

# Show the first few rows of the 'PsO_V2' dataset for verification
```

```{r}
tremor_Read2$gp_tremor <- TRUE
tremor_Read3$gp_tremor <- TRUE
```

```{r}
tremor_Read3subset <- tremor_Read3[, c("eid", "data_provider", "event_dt", "gp_tremor")]

tremor_Read2subset <- tremor_Read2[, c("eid", "data_provider", "event_dt", "gp_tremor")]


# Append the two dataframes together
datTremor_gp <- rbind(tremor_Read2subset, tremor_Read3subset)
```

```{r}
write.csv(datTremor_gp, "datTremor_gp.csv")
```

```{bash}
dx upload datTremor_gp.csv --dest /users/mcgaghd/PrimaryCare/datTremor_gp.csv
```


```{r}
FH_Strings<- "(^Xa6ah)"

# Create the new column "PsO_v2" based on the matching condition
FH_Read2 <- dat_GPevent %>%
  filter(grepl(FH_Strings, read_2, ignore.case = TRUE))

FH_Read3 <- dat_GPevent %>%
  filter(grepl(FH_Strings, read_3, ignore.case = TRUE))

# Show the first few rows of the 'PsO_V2' dataset for verification
```


```{r}
RestlessLegs_Strings<- "^(F13z2|F13z2|Y00ai|Y2203|E274D)$"

# Create the new column "PsO_v2" based on the matching condition
RestlessLegs_Read2 <- dat_GPevent %>%
  filter(grepl(RestlessLegs_Strings, read_2, ignore.case = TRUE))

RestlessLegs_Read3 <- dat_GPevent %>%
  filter(grepl(RestlessLegs_Strings, read_3, ignore.case = TRUE))

# Show the first few rows of the 'PsO_V2' dataset for verification
```

```{r}
RestlessLegs_Read2$gp_RestlessLegs <- TRUE
RestlessLegs_Read3$gp_RestlessLegs <- TRUE
```

```{r}
RestlessLegs_Read3subset <- RestlessLegs_Read3[, c("eid", "data_provider", "event_dt", "gp_RestlessLegs")]

RestlessLegs_Read2subset <- RestlessLegs_Read2[, c("eid", "data_provider", "event_dt", "gp_RestlessLegs")]


# Append the two dataframes together
datRestlessLegs_gp <- rbind(RestlessLegs_Read3subset, RestlessLegs_Read2subset)
```

```{r}
write.csv(datRestlessLegs_gp, "datRestlessLegs_gp.csv")
```

```{bash}
dx upload datRestlessLegs_gp.csv --dest /users/mcgaghd/PrimaryCare/datRestlessLegs_gp.csv
```

```{r}
NightTerror_Strings<- "^(E2748|Eu514|Y00SF)$"

# Create the new column "PsO_v2" based on the matching condition
NightTerror_Read2 <- dat_GPevent %>%
  filter(grepl(NightTerror_Strings, read_2, ignore.case = TRUE))

NightTerror_Read3 <- dat_GPevent %>%
  filter(grepl(NightTerror_Strings, read_3, ignore.case = TRUE))

# Show the first few rows of the 'PsO_V2' dataset for verification
```


```{r}
REMsleep_Strings<- "^(E274B|Y00Rp)$"

# Create the new column "PsO_v2" based on the matching condition
REM_Read2 <- dat_GPevent %>%
  filter(grepl(REMsleep_Strings, read_2, ignore.case = TRUE))

REM_Read3 <- dat_GPevent %>%
  filter(grepl(REMsleep_Strings, read_3, ignore.case = TRUE))

# Show the first few rows of the 'PsO_V2' dataset for verification
```

```{r}
REM_Read2$gp_REM <- TRUE
REM_Read3$gp_REM <- TRUE
```

```{r}
REM_Read3subset <- REM_Read3[, c("eid", "data_provider", "event_dt", "gp_REM")]

REM_Read2subset <- REM_Read2[, c("eid", "data_provider", "event_dt", "gp_REM")]


# Append the two dataframes together
datREM_gp <- rbind(REM_Read3subset, REM_Read2subset)
```

```{r}
write.csv(datREM_gp, "datREM_gp.csv")
```

```{bash}
dx upload datREM_gp.csv --dest /users/mcgaghd/PrimaryCare/datREM_gp.csv
```


```{r}
sleepwalk_Strings<- "^(E2747|Eu513|Y00SH)$"

# Create the new column "PsO_v2" based on the matching condition
sleepwalk_Read2 <- dat_GPevent %>%
  filter(grepl(sleepwalk_Strings, read_2, ignore.case = TRUE))

sleepwalk_Read3 <- dat_GPevent %>%
  filter(grepl(sleepwalk_Strings, read_3, ignore.case = TRUE))

# Show the first few rows of the 'PsO_V2' dataset for verification
```

```{r}
sleepwalk_Read2$gp_Sleepwalk <- TRUE
sleepwalk_Read3$gp_Sleepwalk <- TRUE
```

```{r}
sleepwalk_Read3subset <- sleepwalk_Read3[, c("eid", "data_provider", "event_dt", "gp_Sleepwalk")]

sleepwalk_Read2subset <- sleepwalk_Read2[, c("eid", "data_provider", "event_dt", "gp_Sleepwalk")]


# Append the two dataframes together
datSleepwalk_gp <- rbind(sleepwalk_Read3subset, sleepwalk_Read2subset)
```

```{r}
write.csv(datSleepwalk_gp, "datSleepwalk_gp.csv")
```

```{bash}
dx upload datSleepwalk_gp.csv --dest /users/mcgaghd/PrimaryCare/datSleepwalk_gp.csv
```



```{r}
PsO_Read3strings <- "^M16[^0|^2|^3|^4|^5].*$|Myu30|X506Y|X506Z|X506a|X506b|X506c|X506d|X506e|X506f|X506g|X506h|X506i|X506j|X506k|X506l|X506m|X506n|X506o|X506p|X506q|X506r|X506s|X506t|X506u|X506v|XE1CQ|XaNXa|XaNXt|XaYOx"


# Use data.table's fast filter function
PsO_Read3 <- dat_GPevent %>%
  filter(grepl(PsO_Read3strings, read_3, ignore.case = TRUE))
```

Filter for PsA - Read codes -> all subtypes of M160, and juvenile codes  

```{r}
psori_table <- dat_GPmap %>%
  filter(grepl("^M16[^0|^2|^3|^4|^5].*$|Myu30|X506Y|X506Z|X506a|X506b|X506c|X506d|X506e|X506f|X506g|X506h|X506i|X506j|X506k|X506l|X506m|X506n|X506o|X506p|X506q|X506r|X506s|X506t|X506u|X506v|XE1CQ|XaNXa|XaNXt|XaYOx", READV2_CODE, ignore.case = TRUE))
```


```{r}
PsA_V3 <- dat_GPmap %>%
  filter(!is.na(READV3_CODE) & str_detect(READV3_CODE, "^(?i)(M160(.*)|M1600|M160z|Nyu13|X701u|X701v|X701w|X7026|X7027|X7028)")) %>%
  arrange(TERMV2_ORDER)
```

READV3 codes for PsA 
```{r}
PsA_V3 <- dat_GPmap %>%
  filter(!is.na(READV3_CODE) & str_detect(READV3_CODE, "^(?i)(M160(.*)|M1600|M160z|Nyu13|X701u|X701v|X701w|X7026|X7027|X7028)")) %>%
  arrange(TERMV2_ORDER)
```

Term3 codes for PsA 
```{r}
#READ V3 codes 

PsA_Read3 <- dat_GPmap %>%
  filter(!is.na(TERMV3_CODE) & str_detect(TERMV3_CODE, "^(Y70Eo|Y70Es|Y70Et|YMAqA|Y70Ex|Y70Er|YMAq6|YMAMW|Y70En)")) %>%
  arrange(TERMV2_ORDER)
```

ReadV2 codes for psoriasis
```{r}
PsO_V2 <- dat_GPmap %>%
  filter(!is.na(READV2_CODE) & str_detect(READV2_CODE, "^(^M16[^0|^2|^3|^4|^5].*$|Myu30|14F2.)")) %>%
  arrange(TERMV2_ORDER)
```

TERMV3_CODE for psoriasis

```{r}
PsO_V3 <- dat_GPmap %>%
  filter(!is.na(READV3_CODE) & str_detect(READV3_CODE, "^M16[^0|^2|^3|^4|^5].*$|Myu30|X506Y|X506Z|X506a|X506b|X506c|X506d|X506e|X506f|X506g|X506h|X506i|X506j|X506k|X506l|X506m|X506n|X506o|X506p|X506q|X506r|X506s|X506t|X506u|X506v|XE1CQ|XaNXa|XaNXt|XaYOx")) %>%
  arrange(TERMV2_ORDER)
```


Now create a Read v2, CTV3 and v3 list for each 

Psoriasis first 
```{r}
PsO_Read2Strings<- "^(^M16[^0|^2|^3|^4|^5].*$|Myu30|14F2.)"

# Create the new column "PsO_v2" based on the matching condition
PsO_Read2 <- dat_GPevent %>%
  filter(grepl(PsO_Read2Strings, read_2, ignore.case = TRUE))

# Show the first few rows of the 'PsO_V2' dataset for verification
```

```{r}
PsO_Read3strings <- "^M16[^0|^2|^3|^4|^5].*$|Myu30|X506Y|X506Z|X506a|X506b|X506c|X506d|X506e|X506f|X506g|X506h|X506i|X506j|X506k|X506l|X506m|X506n|X506o|X506p|X506q|X506r|X506s|X506t|X506u|X506v|XE1CQ|XaNXa|XaNXt|XaYOx"


# Use data.table's fast filter function
PsO_Read3 <- dat_GPevent %>%
  filter(grepl(PsO_Read3strings, read_3, ignore.case = TRUE))
```

```{r}
PsO_Read2 <- PsO_Read2 %>%
  filter(!is.na(event_dt))
PsO_Read2[is.na(PsO_Read2)] <- ""

PsO_Read3 <- PsO_Read3 %>%
  filter(!is.na(event_dt))
PsO_Read3[is.na(PsO_Read3)] <- ""
```


Data cleaning. As we're confident in our codes from data extract script. We can just create a ew column of Psoriasis T/F or PsA TRUE/FALSE

```{r}
PsO_Read3$gp_PsO <- TRUE
PsO_Read2$gp_PsO <- TRUE
```

```{r}
PsO_Read3subset <- PsO_Read3[, c("eid", "data_provider", "event_dt", "gp_PsO")]
PsO_Read2subset <- PsO_Read2[, c("eid", "data_provider", "event_dt", "gp_PsO")]

# Append the two dataframes together
datPsO_gp <- rbind(PsO_Read2subset, PsO_Read3subset)
```

```{r}
datPsO_gp <- datPsO_gp %>%
  filter(event_dt > as.Date("1940-01-01"))
```

```{r}
write.csv(datPsO_gp, "datPsO_gp.csv")
```

```{bash}
dx upload datPsO_gp.csv --dest /users/mcgaghd/PrimaryCare/datPsO_gp.csv
```

PsA Read V2 
```{r} 
PsA_Read2Strings <- "^(?i)(M160(.*)|M1602|N0452|Nyu13)"


# Use data.table's fast filter function
PsA_Read2 <- dat_GPevent %>%
  filter(grepl(PsA_Read2Strings, read_2, ignore.case = TRUE))
```

```{r}
PsA_Read3Strings  <-"^(?i)(M160(.*)|M1600|M160z|Nyu13|X701u|X701v|X701w|X7026|X7027|X7028)"

PsA_Read3 <- dat_GPevent %>%
  filter(grepl(PsA_Read3Strings, read_3, ignore.case = TRUE))
```

```{r}
PsA_Read2 <- PsA_Read2 %>%
  filter(!is.na(event_dt))
PsA_Read2[is.na(PsA_Read2)] <- ""

PsA_Read3 <- PsA_Read3 %>%
  filter(!is.na(event_dt))
PsA_Read3[is.na(PsA_Read3)] <- ""
```


Data cleaning. As we're confident in our codes from data extract script. We can just create a ew column of Psoriasis T/F or PsA TRUE/FALSE

```{r}
PsA_Read3$gp_PsA <- TRUE
PsA_Read2$gp_PsA <- TRUE
```

```{r}
PsA_Read3subset <- PsA_Read3[, c("eid", "data_provider", "event_dt", "gp_PsA")]
PsA_Read2subset <- PsA_Read2[, c("eid", "data_provider", "event_dt", "gp_PsA")]

# Append the two dataframes together
datPsA_gp <- rbind(PsA_Read2subset, PsA_Read3subset)
```

```{r}
datPsA_gp <- datPsA_gp %>%
  filter(event_dt > as.Date("1940-01-01"))
```

```{r}
write.csv(datPsA_gp, "datPsA_gp.csv")
```

```{bash}
dx upload datPsA_gp.csv --dest /users/mcgaghd/PrimaryCare/datPsA_gp.csv
```


#Morning stiffness 


```{r}
MorningStiffness <- dat_GPmap %>%
  filter(!is.na(READV3_CODE) & str_detect(TERMV3_CODE, "^(Ya1np)")) %>%
  arrange(TERMV2_ORDER)
```

```{r}
MorningStiffnessStrings  <-"(^Xa0YV|^Ya1np|^1D17.$)"

MorningStiffness_Read2 <- dat_GPevent %>%
  filter(grepl(MorningStiffnessStrings, read_2, ignore.case = TRUE))
```

```{r}
# Use data.table's fast filter function
MorningStiffness_Read3 <- dat_GPevent %>%
  filter(grepl(MorningStiffnessStrings, read_3, ignore.case = TRUE))
```

```{r}
MorningStiffness_Read2$gp_EMS <- TRUE
MorningStiffness_Read3$gp_EMS <- TRUE
```

```{r}
EMS_read3subset <- MorningStiffness_Read3[, c("eid", "data_provider", "event_dt", "gp_EMS")]
EMS_read2subset <- MorningStiffness_Read2[, c("eid", "data_provider", "event_dt", "gp_EMS")]

# Append the two dataframes together
datEMS_gp <- rbind(EMS_read3subset, EMS_read2subset)
```
 
```{r}
write.csv(datEMS_gp, "datEMS_gp.csv")
```

```{bash}
dx upload datEMS_gp.csv --dest /users/mcgaghd/PrimaryCare/datEMS_gp.csv
```


